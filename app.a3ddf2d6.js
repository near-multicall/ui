!function(){function t(t,e,s,n){Object.defineProperty(t,e,{get:s,set:n,enumerable:!0,configurable:!0})}var e=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequired5b2,s=e.register;s("1xLrT",function(s,n){Object.defineProperty(s.exports,"__esModule",{value:!0,configurable:!0}),t(s.exports,"default",function(){return o});var o=e("hQdrk").AppPage}),s("hQdrk",function(s,n){t(s.exports,"AppPage",function(){return f});var o=e("dxWQo"),l=e("lBpE3"),r=e("44iF5"),a=e("6cds3"),i=e("hDmOL"),u=e("kYkTt"),d=e("2jbdu"),c=e("1MoUG"),m=e("dc0x8"),h=e("hAy3h");class f extends a.Component{fromJSON(t){this.clear();let e=m.STORAGE.layout;if(!Array.isArray(t)||!t.length)return;this.columnID=0;let s={...e,columnOrder:[],columns:{menu:e.columns.menu}};for(let e in t){let n={id:`column-${this.columnID}`,title:"Drag here",taskIds:[]},o=Array.from(s.columnOrder);for(let l in o.push(`column-${this.columnID}`),s={...s,columns:{...s.columns,[`column-${this.columnID}`]:n},columnOrder:o},this.columnID++,t[e]){let o={id:`task-${this.taskID++}`,family:"",func:"",json:t[e][l]};s.columns[n.id].taskIds.push(o.id),s.tasks[o.id]=o}}(0,m.STORAGE).setLayout(s)}fromBase64(t){this.clear();let e=m.STORAGE.layout;if(!Array.isArray(t)||!t.length)return;this.columnID=0;let s={...e,columnOrder:[],columns:{menu:e.columns.menu}};for(let e in t){let n={id:`column-${this.columnID}`,title:"Drag here",taskIds:[]},o=Array.from(s.columnOrder);for(let l in o.push(`column-${this.columnID}`),s={...s,columns:{...s.columns,[`column-${this.columnID}`]:n},columnOrder:o},this.columnID++,t[e]){let{address:o,actions:a}=t[e][l],i={id:`task-${this.taskID++}`,family:"",func:"",json:{address:o,actions:a.map(t=>({func:t.func,args:JSON.parse((0,r.Base64).decode(t.args)),gas:t.gas,depo:t.depo}))}};s.columns[n.id].taskIds.push(i.id),s.tasks[i.id]=i}}(0,m.STORAGE).setLayout(s)}toJSON(t=!1){let e=m.STORAGE.layout,s=[];for(let n of e.columnOrder)if(0!==e.columns[n].taskIds.length)for(let o of(s.push([]),e.columns[n].taskIds)){let e=TASKS.find(t=>t.id===o);if(e){if(t)try{s[s.length-1].push(e.instance.current.toCall())}catch(t){continue}else s[s.length-1].push(e.instance.current.toCall())}else console.warn(`no task with id ${o}`)}return s}toBase64(t=!1){let e=m.STORAGE.layout,s=[];for(let n of e.columnOrder)if(0!==e.columns[n].taskIds.length)for(let o of(s.push([]),e.columns[n].taskIds)){let e=TASKS.find(t=>t.id===o);if(e){if(t)try{s[s.length-1].push((0,h.fromCall).toBase64(e.instance.current.toCall()))}catch(t){continue}else s[s.length-1].push((0,h.fromCall).toBase64(e.instance.current.toCall()))}else console.warn(`no task with id ${o}`)}return s}toErrors(){var t;let e=m.STORAGE.layout,s=[];if(!(null===(t=window)||void 0===t?void 0:t.TASKS))return s;for(let t of TASKS.filter(t=>!e.columns.menu.taskIds.includes(t.id)).map(t=>t.instance.current))for(let e of t.schema.errors())s.push({task:t,message:e.message});return s}export(){return JSON.stringify({schedules:this.toBase64()})}empty(){let t=m.STORAGE.layout;return 1===t.columnOrder.length&&0===t.columns[t.columnOrder[0]].taskIds.length}setExpanded(t){this.expanded=t,this.forceUpdate(),SIDEBAR.forceUpdate()}componentDidMount(){window.SIDEBAR.switchPage("app"),window.LAYOUT=this,(0,m.STORAGE).load()}render(){let t=m.STORAGE.layout;return(0,l.jsxs)(i.DragDropContext,{onDragEnd:this.onDragEnd,children:[(0,l.jsx)(i.Droppable,{droppableId:"layout",direction:"horizontal",type:"column",children:e=>(0,l.jsxs)("div",{className:"layout-wrapper",children:[(0,l.jsxs)("div",{className:"layout-container",tutorial:this.empty()?"yes":"no",...e.droppableProps,ref:e.innerRef,children:[t.columnOrder.map((e,s)=>{let n=t.columns[e],o=n.taskIds.map(e=>t.tasks[e]);return(0,l.jsx)(u.Column,{column:n,tasks:o,index:s},n.id)}),e.placeholder]}),(0,l.jsx)("div",{className:`empty-container ${this.expanded?"expanded-empty":""}`})]})}),(0,l.jsx)(d.Menu,{layout:this})]})}constructor(t){super(t),(0,o._)(this,"taskID",0),(0,o._)(this,"columnID",1),(0,o._)(this,"expanded",!1),(0,o._)(this,"getTaskID",()=>this.taskID),(0,o._)(this,"getColumnID",()=>this.columnID),(0,o._)(this,"getTasks",()=>m.STORAGE.layout.tasks),(0,o._)(this,"getColumns",()=>m.STORAGE.layout.columns),(0,o._)(this,"deleteTask",t=>{let e=m.STORAGE.layout,{columnId:s,taskIndex:n}=f.findTaskCoordinates(t);if(void 0==s||void 0==n){console.error("Task not found");return}let o=e.columns[s],l=Array.from(o.taskIds);l.splice(n,1);let r={...o,taskIds:l},a={...e,columns:{...e.columns,[s]:r}};(0,m.STORAGE).setLayout(a)}),(0,o._)(this,"duplicateTask",t=>{let e=m.STORAGE.layout,{columnId:s,taskIndex:n}=f.findTaskCoordinates(t);if(void 0==s||void 0==n){console.error("Task not found");return}let o=JSON.parse(JSON.stringify(e.tasks[t.toString()]));o.id=`task-${this.taskID}`;let l=e.columns[s],r=Array.from(l.taskIds);r.splice(n,0,o.id),this.taskID++;let a={...l,taskIds:r},i={...e,columns:{...e.columns,[s]:a},tasks:{...e.tasks,[o.id]:o}};window.COPY={from:t,to:o.id},(0,m.STORAGE).setLayout(i)}),(0,o._)(this,"clear",()=>{var t;console.warn("layout cleared"),window.TASKS&&(window.TASKS=[]),this.taskID=0,this.columnID=1,null===(t=window.EDITOR)||void 0===t||t.edit(null),(0,m.STORAGE).setLayout(c.initialData)}),(0,o._)(this,"deleteColumn",t=>{let e=m.STORAGE.layout,s=Array.from(e.columnOrder);s.splice(t,1);let n={...e,columnOrder:s};0===s.length&&(n={...e,columns:{...e.columns,[`column-${this.columnID}`]:{id:`column-${this.columnID}`,title:"Drag here",taskIds:[]}},columnOrder:[`column-${this.columnID++}`]}),(0,m.STORAGE).setLayout(n)}),(0,o._)(this,"addColumn",()=>{let t={id:`column-${this.columnID}`,title:"Drag here",taskIds:[]},e=m.STORAGE.layout,s=Array.from(e.columnOrder);s.push(`column-${this.columnID}`);let n={...e,columns:{...e.columns,[`column-${this.columnID}`]:t},columnOrder:s};this.columnID++,(0,m.STORAGE).setLayout(n)}),(0,o._)(this,"onDragEnd",t=>{let e=m.STORAGE.layout,{destination:s,source:n,draggableId:o,type:l}=t;if(!s||s.droppableId===n.droppableId&&s.index===n.index)return;if("column"===l){let t=Array.from(e.columnOrder);t.splice(n.index,1),t.splice(s.index,0,o);let l={...e,columnOrder:t};(0,m.STORAGE).setLayout(l);return}let r=e.columns[n.droppableId],a=e.columns[s.droppableId];if(!r||!a){console.warn(`Something went wrong when dragging from ${r} to ${a}`);return}if(r===a){let t=Array.from(r.taskIds);t.splice(n.index,1),t.splice(s.index,0,o);let l={...r,taskIds:t},a={...e,columns:{...e.columns,[l.id]:l}};(0,m.STORAGE).setLayout(a)}else{let t;if("menu"===a.id)return;if("menu"===r.id){let s=Array.from(r.taskIds),o=s[n.index];s[n.index]=`task-${this.taskID}`;let l=JSON.parse(JSON.stringify(e.tasks[o.toString()]));l.id=`task-${this.taskID}`,m.STORAGE.layout.tasks[l.id]=l,this.taskID++,t={...r,taskIds:s}}else{let e=Array.from(r.taskIds);e.splice(n.index,1),t={...r,taskIds:e}}let l=Array.from(a.taskIds);l.splice(s.index,0,o);let i={...a,taskIds:l},u={...e,columns:{...e.columns,[t.id]:t,[i.id]:i}};(0,m.STORAGE).setLayout(u)}}),this.clear(),document.addEventListener("onlayoutupdated",()=>this.forceUpdate())}}(0,o._)(f,"findTaskCoordinates",t=>{let e;let s=m.STORAGE.layout;return{columnId:s.columnOrder.find(n=>(e=s.columns[n].taskIds.indexOf(t))>=0),taskIndex:e}})})}();
//# sourceMappingURL=app.a3ddf2d6.js.map
